:css
  .clause select, body.bp .clause input[type="text"] {
        margin: 0;
        padding: 5px 0;
        display: inline-block;
        min-width: 100px;
        max-width: 200px;
    }
  .clause button {
      margin: 0;
      padding: 5px;
  }
  body.bp .qb > .clause > select,
  body.bp .qb > .clause > input,
  body.bp .qb > .clause > button {
  }

%form.qb{action: advanced_search_items_path}
  = hidden_field_tag :per_page, params[:per_page] || 10
  = hidden_field_tag :authenticity_token, form_authenticity_token

  - (params['clause'] || {_:{}}).values.each_with_index do |clause, i|
    .clause{id: "clause[#{i}]"}
      - if i != 0
        %select{name: "clause[#{i}][logic]"}
          -['AND', 'OR'].each do |l|
            %option{value: l, selected: l == clause['logic']}= l
      %select{name: "clause[#{i}][field]"}
        - @fields.each do |col|
          %option{value: col, selected: clause['field'] == col}= col.titleize
      %select{name: "clause[#{i}][operator]"}
        - ['is', 'is_not', 'contains', 'without'].each do |op|
          %option{value: op, selected: clause['operator'] == op}= op.titleize
      %input{name: "clause[#{i}][input]", type: "text", value: clause['input'].to_s}
      %button.remove{name: "clause[#{i}]", role: "button", type: "button"} Ã—
      %button.add{role: "button", type: "button"} +
  %button.submit{role: "submit", type: "submit"} Submit

:javascript
  var logicSelect = '<select name="clause[0][logic]"><option value="AND">AND</option><option value="OR">OR</option></select>';
  $(document).ready(function() {
    $('button.add:not(:last)').remove();
    var addButton = $('button.add:last').clone();
    $(document).on('click', 'button.remove', function() {
        if (this.name == 'clause[0]') return;
        var row = $('[id="'+this.name+'"]');
        var addButton = row.find('button.add');
        row.remove();
        if (addButton.length) {
          $('div.clause:last').append(addButton.clone());
        }
    });
    $(document).on('click', 'button.add', function() {
        var numRows = $('div.clause').length;
        var row = $('[id="clause[0]"]').clone();
        $('button.add').remove();
        row.attr('id', 'clause['+numRows+']');
        row.prepend($(logicSelect.replace('[0]', '['+numRows+']')));
        row.find('select,input,button').each(function() {
            this.name = this.name.replace('[0]', '['+numRows+']')
        });
        // clear existing vals
        row.find('input').val('');
        row.find('option').attr('selected', null);
        if (!row.find('button.add').length) row.append(addButton);
        $('.qb button.submit').before(row);
    });
  });